# nns-js

A library for interfacing with the Internet Computer's Network Nervous System.

This library is still in active development, and new features will incrementally be available.

- [x] Ledger Canister
  - [x] `accountBalance`
  - [x] `transfer`
- [ ] Governance Canister (Coming soon)

## Example Usage

```ts
import { AccountIdentifier, LedgerCanister } from "@dfinity/nns";

// If not running in browser, add polyfill of `window.fetch` for agent-js to work.
import fetch from "cross-fetch";
global.fetch = fetch;

async function main() {
  const ledger = LedgerCanister.create();

  const accountIdentifier = AccountIdentifier.fromHex(
    "efa01544f509c56dd85449edf2381244a48fad1ede5183836229c00ab00d52df"
  );

  const balance = await ledger.accountBalance({ accountIdentifier });

  console.log(`Balance: ${balance.toE8s()}`);
}

main();
```

# Library detailed design

The flow of an API call is as follows:
```
Request ------[request converter]--------> RawRequest -----.
                                                           |
                                                           V
                                                       [API call]
                                                           |
                                                           |
response <----[response converter]-------- RawResponse <---'
```

- Raw types are autogenerated from canister did files and are stored in the `/candid` directory.
  - Every did file applies to a canister, so the type definitions are similarly segmented by canister;
    this is a hard segmentation, common raw types are NOT factored out.
- nns-js types are designed and implemented manually and are defined under /src:
  - Types specific to one canister are defined in `/src/canisters/${CANISTER_NAME}/`
  - Types shared across canisters are defined in (TODO: was `/src/canisters/common`, where now?).
- Converters from nns-js types to raw types and back are defined in
  `/src/canisters/${CANISTER_NAME}/{request,response}.converters.ts`.
  - The converters contain verbs, not data types.
  - The verbs are called `to${TYPE}` e.g. `toRewardMode` for converting a Raw type to a nns-js type,
    and `from${TYPE}` for the conversion from nns-js types to Raw types.
- The API call itself is made by an `HttpAgent`.
  - The `HttpAgent` type is provided by the `@dfinity/agent` library.
  - An `HttpAgent` may be provided by the `nns-js` library user, otherwise a default will be used.
  - Some API calls are made using protobuf.  Protobuf is deprecated in this context but must be used
    as long as external APIs do not support an alternative.
