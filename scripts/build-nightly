#!/usr/bin/env bash
set -eux

(($(date +%s) - $(git log -n1 --format="%at") < 25 * 3600)) || {
  echo "No recent commits.  Nothing to do.  Aborting."
  exit 1
}

# Bump the prerelease version number.  E.g. v0.2.3 -> v0.2.3-nightly-2022-02-22.0
npm version prerelease --preid "nightly-$(date +%Y-%m-%d)"

# Verify that the code builds and will pack.
npm ci
npm run build
npm test
npm pack
